#!/bin/bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

version="$1"

if [ "" == "$version" ]
then
    version=`git log --pretty="%H" -n1 HEAD`
fi

release=$(php -r "echo (strlen('$version') == 40) ? 'snapshot' : 'stable';")

echo "$release-$version"

sed -i s/REPO-VERSION/$version/g $DIR/../config/app.php
sed -i s/REPO-RELEASE/$release/g $DIR/../config/app.php

./fs-watcher app:build

sed -i s/$version/REPO-VERSION/g $DIR/../config/app.php
sed -i s/$release/REPO-RELEASE/g $DIR/../config/app.php
